---
title: "diamond_prediction"
author: "Joon Soh"
date: "3/11/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Diamond Prediction

1. Load the data.

 - Import libraries that will be used for the project.
 
```{r}
library("tidyverse")
# library(plyr)
library(dplyr)
library(faraway) 
library(multcomp)
library(lawstat)
library(MASS)
```

 - Set the directory to where the files are.

```{r}

# setwd("C:/Users/joony/Documents/myGit/STAT_6021_Project_1")

```

 - Load the data file. 
 
```{r}

data <- read.csv("clean_diamond_data.csv")

# if you want to use the columns without calling the table, attach the table
attach(data)

```

2. Examine the data

 - Display the first few rows of the table
 
```{r}

head(data)

```

 - Check if there is any missing values
 
```{r}

table(is.na(data))

```

 - Look at the count tables for categorical variables.
 
```{r}

table(data$color)

```

```{r}

table(data$clarity)

```

```{r}

table(data$cut)

```

 - Check the range for the numerical variables.
 
```{r}
 
range(data$carat)

```

```{r}

range(data$price)
 
```
3. Preliminary analysis

 - Perform levene's test and plot boxplots.

```{r}

levene.test(price,color)

```

```{r}

boxplot(price~color,data=data, main="Price vs Color", xlab="Color", ylab="Price")

```
 * Ascending order of the colors : "J","I","H","G","F","E","D"
 * Every color class has lots of outliers for high prices - the better the color, the more spread in the outliers.

```{r}

levene.test(price,clarity)

```

```{r}

boxplot(price~clarity,data=data, main="Price vs Clarity", xlab="Clarity", ylab="Price ")

``` 

 * Ascending order of the clarity : "SI2","SI1","VS2","VS1","VVS2","VVS1","IF", "FL"
 * Every clarity class has lots of outliers for high prices.
 
```{r}

levene.test(price,cut)

```

 
```{r}

boxplot(price~cut,data=data, main="Price vs Cut", xlab="Cut", ylab="Price")

```
 * Ascending order of the cuts : "Good","Very Good","Ideal","Astor Ideal"
 * Every cut class has lots of outliers for high prices - the better the cut, the more spread in the outliers.
 
 
 - Now, let's look a scatter plots of the data.
 
```{r}

title = "Price vs. Carat"
xlab = "Carat"
ylab ="Price"
x = carat
y = price

plot(x, y, main=title, xlab=xlab, ylab=ylab)

```
 - Check if there is a differential correlation.
 
```{r}

#let's plot carat vs price by colorscore
d1 <- subset(data, color=="J")
d2 <- subset(data, color=="I")
d3 <- subset(data, color=="H")
d4 <- subset(data, color=="G")
d5 <- subset(data, color=="F")
d6 <- subset(data, color=="E")
d7 <- subset(data, color=="D")
reg1 <- lm(price~carat, data=d1)
reg2 <- lm(price~carat, data=d2)
reg3 <- lm(price~carat, data=d3)
reg4 <- lm(price~carat, data=d4)
reg5 <- lm(price~carat, data=d5)
reg6 <- lm(price~carat, data=d6)
reg7 <- lm(price~carat, data=d7)
plot(carat, price, main="Price vs. Carat by Color", xlab=xlab, ylab=ylab)
points(d2$carat, d2$price, col='red')
points(d3$carat, d3$price, col='blue')
points(d4$carat, d4$price, col='green')
points(d5$carat, d5$price, col='pink')
points(d6$carat, d6$price, col='purple')
points(d7$carat, d7$price, col='orange')
abline(reg1, lty=1)
abline(reg2, lty=2, col='red')
abline(reg3, lty=3, col='blue')
abline(reg4, lty=4, col='green')
abline(reg5, lty=5, col='pink')
abline(reg6, lty=6, col='purple')
abline(reg7, lty=7, col='orange')
legend("topright", c("J","I","H","G","F","E","D"), lty=c(1,2,3,4,5,6,7), col=c('black','red','blue','green','pink','purple','orange'))
#the slopes for all of the lines are similar, but there still may be interaction

```

 
```{r}

#let's plot carat vs price by clarityscore
d1 <- subset(data, clarity=="SI2")
d2 <- subset(data, clarity=="SI1")
d3 <- subset(data, clarity=="VS2")
d4 <- subset(data, clarity=="VS1")
d5 <- subset(data, clarity=="VVS2")
d6 <- subset(data, clarity=="VVS1")
d7 <- subset(data, clarity=="IF")
d8 <- subset(data, clarity=="FL")
reg1 <- lm(price~carat, data=d1)
reg2 <- lm(price~carat, data=d2)
reg3 <- lm(price~carat, data=d3)
reg4 <- lm(price~carat, data=d4)
reg5 <- lm(price~carat, data=d5)
reg6 <- lm(price~carat, data=d6)
reg7 <- lm(price~carat, data=d7)
reg8 <- lm(price~carat, data=d8)
plot(carat, price, main="Price vs. Carat by Clarity", xlab=xlab, ylab=ylab)
points(d2$carat, d2$price, col='red')
points(d3$carat, d3$price, col='blue')
points(d4$carat, d4$price, col='green')
points(d5$carat, d5$price, col='pink')
points(d6$carat, d6$price, col='purple')
points(d7$carat, d7$price, col='orange')
points(d8$carat, d8$price, col='brown')
abline(reg1, lty=1)
abline(reg2, lty=2, col='red')
abline(reg3, lty=3, col='blue')
abline(reg4, lty=4, col='green')
abline(reg5, lty=5, col='pink')
abline(reg6, lty=6, col='purple')
abline(reg7, lty=7, col='orange')
abline(reg8, lty=8, col='brown')
legend("topright", c("SI2","SI1","VS2","VS1","VVS2","VVS1","IF", "FL"), lty=c(1,2,3,4,5,6,7,8), col=c('black','red','blue','green','pink','purple','orange','brown'))
#the slopes for all of the lines are similar, but there still may be interaction

```

```{r}

#let's plot carat vs price by cutscore
d1 <- subset(data, cut=="Good")
d2 <- subset(data, cut=="Very Good")
d3 <- subset(data, cut=="Ideal")
d4 <- subset(data, cut=="Astor Ideal")
reg1 <- lm(price~carat, data=d1)
reg2 <- lm(price~carat, data=d2)
reg3 <- lm(price~carat, data=d3)
reg4 <- lm(price~carat, data=d4)
plot(carat, price, main="Price vs. Carat by Cut", xlab=xlab, ylab=ylab)
points(d2$carat, d2$price, col='red')
points(d3$carat, d3$price, col='blue')
points(d4$carat, d4$price, col='green')
abline(reg1, lty=1)
abline(reg2, lty=2, col='red')
abline(reg3, lty=3, col='blue')
abline(reg4, lty=4, col='green')
legend("topright", c("Good","Very Good","Ideal","Astor Ideal"), lty=c(1,2,3,4), col=c('black','red','blue','green'))
#the slopes for all of the lines are similar, but there still may be interaction

```

```{r}

# perform the linear regression to our newly formatted dataset 
lmodel <- lm(price~.,data)
summary(lmodel)

```

```{r}

##residual plot
plot(lmodel$fitted.values,lmodel$residuals,main="Residual Plot",xlab="Fitted Values", ylab="Residual Values")
abline(h=0,col="red")

```

```{r}

##acf plot of residuals
acf(lmodel$residuals, main="Autocorrelation Plot")

```

```{r}

##QQ plot of residuals
qqnorm(lmodel$residuals, main="Normal Probability Plot")
qqline(lmodel$residuals, col="red")

```

```{r}
# boxcox plotting and transformation
boxcox(lmodel, lambda=seq(.37,0.375,by=0.001), main ="Box-cox plot")
```

```{r}
lamb <- 0.372


newPrice <- price^lamb

data_fixed <- data
data_fixed$price <- newPrice

attach(data_fixed)
```

```{r}

lmodel_fixed <- lm(price~.,data_fixed)
summary(lmodel_fixed)

```

```{r}

title = "Price vs. Carat"
xlab = "Carat"
ylab ="Price"
x = carat
y = price

# Produce a plot. 
plot(x, y, main=title, xlab=xlab, ylab=ylab)

abline(lmodel_fixed, col="red")

```

```{r}

plot(lmodel_fixed$fitted.values,lmodel_fixed$residuals,main="Residual Plot",xlab="Fitted Values",ylab="Residual Values")
abline(h=0,col="red")
```

```{r}
##acf plot of residuals
acf(lmodel_fixed$residuals, main="Autocorrelation Plot")
```


```{r}
##QQ plot of residuals
qqnorm(lmodel_fixed$residuals, main="Normal Probability Plot")
qqline(lmodel_fixed$residuals, col="red")
```
### we have transformed both the response and numerical predictor and the model is more compliant with the linear model assumtions
### we will now see if there are multicollinearity 
```{r}
# perform vif analysis 
vif(lmodel_fixed)
# none of the scores are over 10 ( all of them are actually less than 4)
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```